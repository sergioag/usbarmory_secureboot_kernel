From 34524c850b59748936d18c55b953cfeafa625322 Mon Sep 17 00:00:00 2001
From: Sergio Aguayo <sergioag@qmailhosting.net>
Date: Mon, 28 Mar 2022 02:45:34 -0500
Subject: [PATCH 3/3] Misc changes to support USBArmory in U-Boot 2022.01

---
 board/inversepath/usbarmory-mark-two/usbarmory-mark-two.c | 1 +
 configs/usbarmory-mark-two_defconfig                      | 1 +
 include/configs/usbarmory-mark-two.h                      | 5 -----
 3 files changed, 2 insertions(+), 5 deletions(-)

diff --git a/board/inversepath/usbarmory-mark-two/usbarmory-mark-two.c b/board/inversepath/usbarmory-mark-two/usbarmory-mark-two.c
index 4607b10366..6d7bdd0635 100644
--- a/board/inversepath/usbarmory-mark-two/usbarmory-mark-two.c
+++ b/board/inversepath/usbarmory-mark-two/usbarmory-mark-two.c
@@ -22,6 +22,7 @@
 #include <mmc.h>
 #include <fsl_esdhc_imx.h>
 #include <asm/gpio.h>
+#include <net.h>
 
 DECLARE_GLOBAL_DATA_PTR;
 
diff --git a/configs/usbarmory-mark-two_defconfig b/configs/usbarmory-mark-two_defconfig
index eb10e71d5e..e1719dd2ae 100644
--- a/configs/usbarmory-mark-two_defconfig
+++ b/configs/usbarmory-mark-two_defconfig
@@ -3,6 +3,7 @@ CONFIG_ARCH_MX6=y
 CONFIG_SYS_TEXT_BASE=0x87800000
 CONFIG_TARGET_USBARMORY_MARK_TWO=y
 CONFIG_MX6ULL=y
+CONFIG_SYS_MALLOC_LEN=0xA00000
 
 CONFIG_SYS_DDR_512MB=y
 # CONFIG_SYS_DDR_1GB is not set
diff --git a/include/configs/usbarmory-mark-two.h b/include/configs/usbarmory-mark-two.h
index e7950775bd..9789f47c6c 100644
--- a/include/configs/usbarmory-mark-two.h
+++ b/include/configs/usbarmory-mark-two.h
@@ -27,9 +27,6 @@
 #define CONFIG_SYS_I2C_SPEED 100000
 #define CONFIG_SYS_I2C_MXC_I2C1
 
-/* U-Boot memory offsets */
-#define CONFIG_SYS_LOAD_ADDR	CONFIG_LOADADDR
-
 /* Boot parameters */
 #define USBARMORY_FIT_PATH	"/boot/usbarmory.itb"
 #define USBARMORY_FIT_ADDR	"0x80800000"
@@ -227,6 +224,4 @@
 #define CONFIG_SYS_INIT_SP_ADDR \
 	(CONFIG_SYS_INIT_RAM_ADDR + CONFIG_SYS_INIT_SP_OFFSET)
 
-#define CONFIG_SYS_MALLOC_LEN		(10 * SZ_1M)
-
 #endif	/* __CONFIG_H */
-- 
2.34.1

